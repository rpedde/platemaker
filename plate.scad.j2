// keyboard plate
//
{% for line in source %}
// {{line}}
{%- endfor %}
//
// Produced with "{{ cli }}"
//
// All units are in mm
//

$fn=64;

module cherry_stab(x, y, w) {
  // w = 23.8 for 2u, 2.25u, 2.75u
  // w = 38.1 for 3u
  // w = 133.35 for 8u

  translate([x + 7 - (w/2) - 4.2, y - 1.2]) {
    square([7.525, 13.5]);
  }
  translate([x + 7 + (w/2) - 3.325, y - 1.2]) {
    square([7.525, 13.5]);
  }

  translate([x + 7 - (w/2), y + 4]) {
    square([w, 6]);
  }
}

module cherry_6_25u_stab(x, y) {
}

module cherry1u(x, y) {
    translate([x, y]) {
        square(14);
{%- if dogbone %}
        ofs = sqrt({{tool_size}} * {{tool_size}} / 2);
        translate([ofs, ofs]) circle({{tool_size}});
        translate([ofs, 14 - ofs]) circle({{tool_size}});
        translate([14 - ofs, ofs]) circle({{tool_size}});
        translate([14 - ofs, 14 - ofs]) circle({{tool_size}});
{%- endif %}
    }
};

module drill(size, x, y) {
    translate([x, y]) circle(size);
}

module rounded_rect(x, y, width, height, radius) {
    translate([x, y]) {
        hull() {
            translate([radius, radius]) circle(r=radius);
            translate([radius, height - radius]) circle(r=radius);
            translate([width - radius, radius]) circle(r=radius);
            translate([width - radius, height -radius]) circle(r=radius);
        }
    }
}


difference() {
{% if rounded %}
    rounded_rect(0, 0, {{width}}, {{height}}, {{rounded_toolsize / 2}});
{%- else %}
    square(size=[{{width}},{{height}}]);
{%- endif %}

    union() {
        // Keys
{%- for fn, x, y in keys %}
        {{fn}}({{x}}, {{y}});
{%- endfor %}

        // Stabs
{%- for fn, x, y, w in stabs %}
        {{fn}}({{x}}, {{y}}, {{w}});
{%- endfor %}

        // Drills (screws)
{%- for size, x, y in drills %}
        drill({{size}}, {{x}}, {{y}});
{%- endfor %}
    }
}
